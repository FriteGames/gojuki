<html>

<head>
  <link href="https://fonts.googleapis.com/css?family=Press+Start+2P" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/simple-peer/9.2.1/simplepeer.min.js"></script>
  <script src="./src/index.js"> </script>
  <title>Gojuki</title>
</head>
<style>
  body {
    display: flex;
    flex-direction: column;
    align-items: center;
    touch-action: none;
  }

  canvas {
    border: 1px solid #e91e63;
  }
</style>

<body>
  <div id="app">
    <canvas id="game"></canvas>
  </div>
</body>
<script>
  async function init() {
    const { signal, id } = await (await fetch("/signal")).json();
    console.log("successfully fetched signal from server");
    var p = new SimplePeer({
      trickle: false,
      channelConfig: {
        ordered: false,
        maxRetransmits: 0
      }
    });
    window.peer = p;
    p.on("signal", function (data) {
      console.log("sending our signal to the server");
      fetch("/signal", {
        method: "POST",
        headers: {
          Accept: "application/json",
          "Content-Type": "application/json"
        },
        body: JSON.stringify({ id, signal: data }),
        credentials: "include"
      });
    });

    p.on("connect", function () {
      console.log("CONNECTED");
    });

    p.on("data", function (data) {
      console.log("msg: " + data);
    });

    // get this show on the road
    p.signal(signal);
  }
  init();
</script>

</html>